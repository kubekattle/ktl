apiVersion: v1
kind: ConfigMap
metadata:
  name: payment-app-code
  namespace: default
data:
  app.py: |
    import os
    import time

    def process_payment():
        print("Initializing payment processor...")
        time.sleep(1)
        # Simulate a bug where env var is missing
        # This will raise KeyError: 'PAYMENT_GATEWAY_KEY'
        api_key = os.environ["PAYMENT_GATEWAY_KEY"]
        print(f"Processing with {api_key}")

    if __name__ == "__main__":
        print("Starting application...")
        process_payment()
---
apiVersion: v1
kind: Pod
metadata:
  name: payment-processor
  namespace: default
  labels:
    app: payment-processor
spec:
  containers:
  - name: app
    image: python:3.9-slim
    command: ["python", "/app/app.py"]
    volumeMounts:
    - name: code
      mountPath: /app
  volumes:
  - name: code
    configMap:
      name: payment-app-code
