name: Release guard

on:
  push:
    tags:
      - "v*"

jobs:
  ensure-release:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Check release exists
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          tag="${GITHUB_REF##*/}"
          if ! gh release view "$tag" >/dev/null 2>&1; then
            echo "Release for $tag not found. Create it with 'gh release create $tag ...'."
            exit 1
          fi
