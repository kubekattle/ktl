<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{.Title}}</title>
    <style>
      :root {
        --surface: rgba(255, 255, 255, 0.9);
        --surface-soft: rgba(255, 255, 255, 0.82);
        --border: rgba(15, 23, 42, 0.12);
        --text: #0f172a;
        --muted: rgba(15, 23, 42, 0.65);
        --accent: #2563eb;
        --chip-bg: rgba(37, 99, 235, 0.08);
        --chip-text: #1d4ed8;
        --ease: cubic-bezier(.16,1,.3,1);
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--text);
        font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: radial-gradient(1200px circle at 20% 10%, rgba(255,255,255,0.95), rgba(220,227,241,1));
      }
      .chrome {
        max-width: 1200px;
        margin: 0 auto;
        padding: 48px 56px 72px;
      }
      .panel {
        border-radius: 28px;
        background: var(--surface);
        border: 1px solid var(--border);
        box-shadow: 0 40px 80px rgba(16,23,36,0.12);
        backdrop-filter: blur(18px);
        padding: 32px;
      }
      header {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        align-items: center;
        margin-bottom: 18px;
      }
      h1 {
        font-size: 1.35rem;
        letter-spacing: -0.02em;
        margin: 0;
        font-weight: 650;
      }
      .subtitle {
        color: var(--muted);
        font-size: 0.95rem;
        margin-top: 6px;
        line-height: 1.35;
      }
      .hero {
        display: grid;
        grid-template-columns: 1fr;
        gap: 18px;
        align-items: start;
      }
      .searchWrap {
        display: flex;
        justify-content: center;
      }
      .search {
        width: min(860px, 100%);
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 14px 16px;
        border-radius: 999px;
        background: rgba(255,255,255,0.75);
        border: 1px solid rgba(15,23,42,0.14);
        box-shadow: 0 18px 40px rgba(15,23,42,0.12);
        transition: box-shadow 220ms var(--ease), border-color 220ms var(--ease), transform 220ms var(--ease);
      }
      .search:focus-within {
        border-color: rgba(37,99,235,0.5);
        box-shadow: 0 18px 50px rgba(37,99,235,0.22);
        transform: translateY(-1px);
      }
      .searchIcon {
        width: 18px;
        height: 18px;
        color: rgba(15,23,42,0.55);
        flex: 0 0 auto;
      }
      #q {
        border: 0;
        outline: none;
        background: transparent;
        font-size: 1.05rem;
        width: 100%;
        color: var(--text);
      }
      #q::placeholder { color: rgba(15,23,42,0.48); }
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
      }
      .chip {
        border-radius: 999px;
        padding: 9px 12px;
        background: var(--chip-bg);
        color: var(--chip-text);
        border: 1px solid rgba(37,99,235,0.18);
        font-size: 0.78rem;
        font-weight: 650;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        cursor: pointer;
        user-select: none;
        transition: transform 200ms var(--ease), background 200ms var(--ease), border-color 200ms var(--ease);
      }
      .chip.active {
        background: rgba(37,99,235,0.12);
        border-color: rgba(37,99,235,0.55);
        transform: translateY(-1px);
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 18px;
        margin-top: 22px;
      }
      .layout.detailHidden {
        grid-template-columns: 1fr;
      }
      @media (max-width: 1100px) {
        .chrome { padding: 28px 22px 52px; }
        .layout { grid-template-columns: 1fr; }
      }
      .results {
        padding: 0;
        margin: 0;
        list-style: none;
        border-radius: 24px;
        background: var(--surface-soft);
        border: 1px solid var(--border);
        overflow: hidden;
      }
      .resultItem {
        padding: 14px 16px;
        border-bottom: 1px solid rgba(15,23,42,0.06);
        cursor: pointer;
      }
      .resultItem:last-child { border-bottom: 0; }
      .resultItem:hover { background: rgba(255,255,255,0.6); }
      .resultItem.active { background: rgba(37,99,235,0.08); }
      .k {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .pill {
        border-radius: 999px;
        padding: 6px 9px;
        border: 1px solid rgba(15,23,42,0.12);
        color: rgba(15,23,42,0.78);
        background: rgba(255,255,255,0.7);
        font-size: 0.7rem;
        font-weight: 650;
        letter-spacing: 0.14em;
        text-transform: uppercase;
      }
      .t {
        font-weight: 650;
        letter-spacing: -0.01em;
      }
      .s {
        color: var(--muted);
        margin-top: 6px;
        font-size: 0.92rem;
        line-height: 1.35;
      }
      .detail {
        border-radius: 24px;
        background: var(--surface-soft);
        border: 1px solid var(--border);
        padding: 18px 18px;
        position: sticky;
        top: 18px;
        max-height: calc(100vh - 80px);
        overflow: auto;
      }
      .detail.hidden { display: none; }
      .detail h2 {
        font-size: 1.05rem;
        margin: 0 0 8px 0;
        font-weight: 700;
        letter-spacing: -0.01em;
      }
      pre {
        background: rgba(15,23,42,0.06);
        border: 1px solid rgba(15,23,42,0.08);
        border-radius: 16px;
        padding: 12px 12px;
        overflow: auto;
        font-size: 0.92rem;
        line-height: 1.35;
        margin: 12px 0 0 0;
      }
      .meta {
        color: var(--muted);
        font-size: 0.85rem;
        line-height: 1.35;
        margin-bottom: 12px;
      }
      .empty {
        color: var(--muted);
        padding: 16px;
        border-radius: 16px;
        border: 1px dashed rgba(15,23,42,0.18);
        background: rgba(255,255,255,0.55);
      }
      @media (prefers-reduced-motion: no-preference) {
        .resultItem, .chip { transition: background 220ms var(--ease), transform 220ms var(--ease); }
      }
    </style>
  </head>
  <body>
    <div class="chrome">
      <div class="panel">
        <header>
          <div>
            <h1>{{.Title}}</h1>
            <div class="subtitle">Search commands, flags, and environment variables. Select a result to see docs and examples.</div>
          </div>
          <div class="subtitle" id="meta"></div>
        </header>

        <div class="hero">
          <div class="searchWrap">
            <div class="search" role="search">
              <svg class="searchIcon" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M10 18a8 8 0 1 1 5.293-14.001A8 8 0 0 1 10 18Zm8.707 1.293-3.4-3.4a10 10 0 1 0-1.414 1.414l3.4 3.4a1 1 0 0 0 1.414-1.414Z"/>
              </svg>
              <input id="q" autocomplete="off" spellcheck="false" placeholder="Search: apply, --namespace, KTL_SANDBOX_CONFIGâ€¦" />
            </div>
          </div>
          <div class="chips" aria-label="Filters">
            <div class="chip active" data-kind="all">All</div>
            <div class="chip" data-kind="command">Commands</div>
            <div class="chip" data-kind="flag">Flags</div>
            <div class="chip" data-kind="env">Env</div>
          </div>
        </div>

        <div class="layout" role="main">
          <div>
            <ul class="results" id="results"></ul>
          </div>
          <div class="detail hidden" id="detail"></div>
        </div>
      </div>
    </div>

    <script>
      const state = {
        index: null,
        q: "",
        kind: "all",
        results: [],
        activeId: null,
      };

      const includeAll = {{if .All}}true{{else}}false{{end}};

      const elQ = document.getElementById("q");
      const elResults = document.getElementById("results");
      const elDetail = document.getElementById("detail");
      const elMeta = document.getElementById("meta");
      const elLayout = document.querySelector(".layout");

      function norm(s) { return (s || "").toLowerCase(); }

      function score(entry, q) {
        if (!q) return 1;
        const hay = norm(entry.title + " " + (entry.subtitle || "") + " " + (entry.content || "") + " " + (entry.tags || []).join(" "));
        const needle = norm(q);
        if (hay === needle) return 1000;
        if (entry.title && norm(entry.title) === needle) return 800;
        if (entry.title && norm(entry.title).includes(needle)) return 520;
        if (hay.startsWith(needle)) return 240;
        const idx = hay.indexOf(needle);
        if (idx >= 0) return 200 - Math.min(150, idx / 10);
        return 0;
      }

      function filterAndRank() {
        if (!state.index) return [];
        const q = state.q.trim();
        const kind = state.kind;
        const scored = [];
        for (const entry of state.index.entries) {
          if (kind !== "all" && entry.kind !== kind) continue;
          const s = score(entry, q);
          if (q && s <= 0) continue;
          if (!q && entry.kind !== "command") continue;
          scored.push({ entry, s });
        }
        scored.sort((a, b) => b.s - a.s || a.entry.title.localeCompare(b.entry.title));
        return scored.slice(0, 80).map(x => x.entry);
      }

      function renderResults() {
        elResults.innerHTML = "";
        for (const entry of state.results) {
          const li = document.createElement("li");
          li.className = "resultItem" + (entry.id === state.activeId ? " active" : "");
          li.dataset.id = entry.id;
          const row = document.createElement("div");
          row.className = "k";
          const pill = document.createElement("span");
          pill.className = "pill";
          pill.textContent = entry.kind;
          const title = document.createElement("span");
          title.className = "t";
          title.textContent = entry.title;
          row.appendChild(pill);
          row.appendChild(title);
          li.appendChild(row);
          if (entry.subtitle) {
            const sub = document.createElement("div");
            sub.className = "s";
            sub.textContent = entry.subtitle;
            li.appendChild(sub);
          }
          li.addEventListener("click", () => select(entry.id));
          elResults.appendChild(li);
        }
        if (state.results.length === 0) {
          const li = document.createElement("li");
          li.className = "resultItem";
          li.innerHTML = '<div class="s">No matches.</div>';
          elResults.appendChild(li);
        }
      }

      function renderDetail(entry) {
        elDetail.innerHTML = "";
        if (!entry) {
          elDetail.classList.add("hidden");
          elLayout.classList.add("detailHidden");
          return;
        }
        elDetail.classList.remove("hidden");
        elLayout.classList.remove("detailHidden");
        const h2 = document.createElement("h2");
        h2.textContent = entry.title;
        elDetail.appendChild(h2);
        if (entry.subtitle) {
          const meta = document.createElement("div");
          meta.className = "meta";
          meta.textContent = entry.subtitle;
          elDetail.appendChild(meta);
        }
        if (entry.content) {
          const hasNewlines = entry.content.indexOf("\n") >= 0;
          if (hasNewlines) {
            const pre = document.createElement("pre");
            pre.textContent = entry.content;
            elDetail.appendChild(pre);
          } else {
            const p = document.createElement("div");
            p.className = "s";
            p.textContent = entry.content;
            elDetail.appendChild(p);
          }
        }
        if (entry.examples && entry.examples.length) {
          const pre = document.createElement("pre");
          pre.textContent = entry.examples.join("\n\n");
          elDetail.appendChild(pre);
        }
      }

      function select(id) {
        state.activeId = id;
        const entry = state.results.find(e => e.id === id) || (state.index && state.index.entries.find(e => e.id === id));
        renderResults();
        renderDetail(entry);
      }

      function onQueryChanged() {
        state.q = elQ.value || "";
        state.results = filterAndRank();
        if (state.results.length && !state.activeId) {
          state.activeId = state.results[0].id;
        }
        if (state.activeId && !state.results.some(e => e.id === state.activeId)) {
          state.activeId = state.results.length ? state.results[0].id : null;
        }
        renderResults();
        renderDetail(state.activeId ? state.results.find(e => e.id === state.activeId) : null);
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "/" && document.activeElement !== elQ) {
          e.preventDefault();
          elQ.focus();
          return;
        }
        if (e.key === "Escape" && document.activeElement === elQ) {
          e.preventDefault();
          elQ.value = "";
          state.activeId = null;
          onQueryChanged();
        }
      });

      document.querySelectorAll(".chip").forEach(chip => {
        chip.addEventListener("click", () => {
          document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          state.kind = chip.dataset.kind;
          state.activeId = null;
          onQueryChanged();
          elQ.focus();
        });
      });

      elQ.addEventListener("input", onQueryChanged);
      elQ.addEventListener("keydown", (e) => {
        if (e.key === "ArrowDown" || e.key === "ArrowUp") {
          e.preventDefault();
          if (!state.results.length) return;
          const idx = state.results.findIndex(e2 => e2.id === state.activeId);
          const next = e.key === "ArrowDown" ? Math.min(state.results.length - 1, idx + 1) : Math.max(0, idx - 1);
          state.activeId = state.results[next].id;
          renderResults();
          renderDetail(state.results[next]);
        }
        if (e.key === "Enter" && state.activeId) {
          select(state.activeId);
        }
      });

      async function boot() {
        const res = await fetch(includeAll ? "/api/index.json?all=1" : "/api/index.json");
        state.index = await res.json();
        elMeta.textContent = "Press / to search";
        onQueryChanged();
        elQ.focus();
      }

      boot().catch(err => {
        elDetail.innerHTML = '<div class="empty">Failed to load help index: ' + (err && err.message ? err.message : err) + '</div>';
      });
    </script>
  </body>
</html>
